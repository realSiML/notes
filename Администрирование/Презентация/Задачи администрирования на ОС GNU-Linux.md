
***

## Содержание

 - [[#Очистка диска]]
	 - [[#Проверка свободного места на диске]]
	 - [[#Как освободить место на диске (Консоль)]]
		 - [[#1. Избавиться от ненужных пакетов [Рекомендуется]]]
		 - [[#2. Удалить ненужные приложения [Рекомендуется]]]
			 - [[#Какая разница между `apt-get remove` и `apt-get purge`?]]
		 - [[#3. Очистка кэша APT]]
		 - [[#4. Очистка журнала systemd]]
		 - [[#5. Удалить старые версии Snap приложений]]
		 - [[#6. Очистка кэша миниатюр]]
		 - [[#7. Найти и удалить дубликаты файлов]]
		 - [[#Удалить старые ядра Linux, которые были установлены вручную*]]
		 - [[#Удалить осиротевшие пакеты (orphaned packages)*]]
	 - [[#Как освободить место на диске (GUI)]]
		 - [[#1. Stacer]]
		 - [[#2. BleachBit]]
		 - [[#3. Ubuntu Cleaner]]
 - [[#Сканирование диска (FSCK)]]
	 - 
 - [[#Дефрагментация]]
	 - [[#e4defrag]]
	 - [[#Shake]]

***

## Очистка диска

За основу была взята [статья](https://itsfoss.com/free-up-space-ubuntu-linux/) из web портала -  [It's FOSS - World's Leading Linux & Open Source Web Portal](https://itsfoss.com/)

Со временем любая операционная система может загромождаться по мере добавления и удаления программ. Если у вас есть около 1 ТБ емкости для хранения, вы можете не утруждаться очисткой системы на GNU/Linux, чтобы освободить место на диске. Но если ваш жесткий диск имеет ограниченное пространство, например, ноутбук с твердотельным накопителем на 128 ГБ, освобождение дискового пространства становится необходимостью.

### Проверка свободного места на диске

[`df`](https://losst.pro/komanda-df-linux) (disk free) — утилита в UNIX и UNIX-подобных системах, показывает список всех файловых систем по именам устройств, сообщает их размер, занятое и свободное пространство и точки монтирования.

Например:

```bash
df -Th
```

![[Снимок экрана от 2022-11-29 08-09-57.png]]

[`du`](https://losst.pro/komanda-du-v-linux) (disk usage) — стандартная Unix-программа для оценки занимаемого файлового пространства. По умолчанию показывает размер файлового пространства, занимаемого каждым файлом и каталогом в текущем каталоге.

Например:

```bash
sudo du -sh /var/cache/apt 
```

![Clean up cache in Ubuntu Linux](https://itsfoss.com/wp-content/uploads/2017/06/clean-up-space-ubuntu-linux-2.png)

Проверить свободно место на диске графически намного проще в **Ubuntu** с помощью **`Анализатора использования дисков`**.

![Disk Usage Analyzer Tool Linux](https://itsfoss.com/wp-content/uploads/2020/11/disk-usage-analyzer-tool-linux.jpg)

![Free Disk Space Ubuntu Desktop](https://itsfoss.com/wp-content/uploads/2020/11/free-disk-space-ubuntu-desktop-800x648.png)
![Disk Usage Analyzer (Baobab)](https://pingvinus.ru/cr_images/screenshot/1065t-baobab-3.4.1.png)

Или с помощью **`Gnome Disk Utility`**.

![Disks Tool Linux](https://itsfoss.com/wp-content/uploads/2020/11/disks-tool-linux.jpg)

![Free Disk Space Check Ubuntu Desktop](https://itsfoss.com/wp-content/uploads/2020/11/free-disk-space-check-ubuntu-desktop.png)

### Как освободить место на диске (Консоль)

Есть множество способов как очистить дисковое пространство в **Ubuntu** или других **основанных на  Ubuntu** системах. Ниже приведены несколько "**command-line tricks**" (инструкций командной строки), а также варианты утилит с графическим интерфейсом.

#### 1. Избавиться от ненужных пакетов [Рекомендуется]

У команды `apt-get`  есть опция `autoremove` (автоудаление).

С помощью нее можно удалить библиотеки и пакеты, которые были установлены автоматически для удовлетворения зависимостей другого установленного пакета. Если этот пакет удален, то эти автоматически установленные пакеты бесполезны в системе. Эта команда удаляет такие пакеты.

>Удаляемые пакеты часто называют "неиспользуемыми зависимостями". На самом деле, хорошей практикой является использование `autoremove` после удаления пакета, чтобы быть уверенным, что не осталось ненужных файлов

Она также удаляет *старые ядра Linux*, которые были **автоматически** установлены при обновлении системы.

Например:

```bash
sudo apt-get autoremove
```

![Free up space with autoremove command](https://itsfoss.com/wp-content/uploads/2017/06/clean-up-space-ubuntu-linux-1.png)

В итоге освободим 300 МБ дискового пространства.

#### 2. Удалить ненужные приложения [Рекомендуется]

Вы можете удалить программу в Ubuntu из **`центра приложений Ubuntu`**:

![Find installed software in Ubuntu](https://itsfoss.com/wp-content/uploads/2017/06/find-installed-software-ubuntu.jpeg)

Или использовать приведенную ниже команду с конкретными именами приложений:

```bash
sudo apt-get remove package-name1 [package-name2 ...]
```

Или:

```bash
sudo apt-get purge package-name1 [package-name2 ...]
```

##### Какая разница между `apt-get remove` и `apt-get purge`?

-   `apt-get remove` просто удаляет двоичные файлы пакета. Она не трогает конфигурационные файлы

-   `apt-get purge` удаляет все, что связано с пакетом, включая конфигурационные файлы

Таким образом, если вы "удалили" (removed) определенный кусочек программного обеспечения и затем установите его снова, ваша система будет иметь те же самые конфигурационные файлы. Конечно, вас попросят переопределить существующие конфигурационные файлы при повторной установке.

Очистка особенно полезна, когда вы испортили конфигурацию программы, когда вы хотите полностью стереть ее следы из системы и начать все заново.

В большинстве случаев простого удаления более чем достаточно для удаления пакета.

#### 3. Очистка кэша APT

Ubuntu использует [APT](https://wiki.debian.org/Apt) (Advanced Package Tool) для установки, удаления и управления пакетами в системе, в то же время он хранит в кэше скачанные и установленные пакеты даже после того, как они были удалены (uninstalled).

DEB пакеты хранятся в кэше по пути: `/var/cache/apt/archives`. Со временем этот кэш может стать очень большим и содержать много ненужных пакктов.

Можно узнать размер этого кэша командой `du`:

```bash
sudo du -sh /var/cache/apt 
```

Можем увидеть такую картину:

![Clean up cache in Ubuntu Linux](https://itsfoss.com/wp-content/uploads/2017/06/clean-up-space-ubuntu-linux-2.png)

У нас есть 2 варианта очистки кэша.

- Либо удалить только старые версии пакетов, которых больше нет в репозитории

```bash
sudo apt-get autoclean
```

- Или удалить кэш полностью

```bash
sudo apt-get clean
```

#### 4. Очистка журнала systemd

Systemd — подсистема инициализации и управления службами в Linux

Журнал systemd — это собственная система журналирования systemd. Она собирает и хранит данные журнала ядра, сообщения системного журнала, стандартный вывод и ошибки для различных системных служб.

Машина Linux с systemd записывает журналы в каталог `/var/log/journal`.

Проблема в том, что со временем эти журналы занимают значительный объем дискового пространства.

Вы можете проверить размер журнала с помощью этой команды:

```bash
journalctl --disk-usage
```

Есть [несколько способов](https://linuxhandbook.com/clear-systemd-journal-logs/) очистки этого журнала. 

Два простейших из них:

1. Удалить логи, которые старше X дней

```bash
sudo journalctl --vacuum-time=Xd
```

2.  Сократить логи до определенного размера

```bash
sudo journalctl --vacuum-size=XY
```

где `Y` может быть T для ТБ, G для ГБ, M для МБ, K для КБ и. т. д

Пример:

```
$ journalctl --disk-usage
Archived and active journals take up 1.8G in the file system.

$ sudo journalctl --vacuum-time=3d
Vacuuming done, freed 1.7G of archived journals from /var/log/journal/1b9ab93094fa2984beba73fd3c48a39c
```

#### 5. Удалить старые версии Snap приложений

Вы, наверное, уже знаете, что пакеты **Snap** больше по размеру. Кроме того, Snap хранит как минимум две более старые версии приложения (на случай, если вы захотите вернуться к более старой версии). Это съедает огромный кусок пространства.

Например:

```
du -h /var/lib/snapd/snaps
4.0K    /var/lib/snapd/snaps/partial
5.6G    /var/lib/snapd/snaps
```

**Alan Pope**, член команды **Snapcraft** в **Canonical**, создал небольшой скрипт, который вы можете использовать и запускать для очистки всех старых версий ваших приложений Snap.

Вам надо [создать новый shell-скрипт](https://linuxhandbook.com/run-shell-script/) с кодом ниже:

```bash
#!/bin/bash
# Removes old revisions of snaps
# CLOSE ALL SNAPS BEFORE RUNNING THIS
set -eu
snap list --all | awk '/disabled/{print $1, $3}' |
    while read snapname revision; do
        snap remove "$snapname" --revision="$revision"
    done
```

Дать этому файлу права на выполнение и запустить его с правами суперпользователя.

В нашем примере, в итоге, скрипт удалил старые пакеты Snap и освободил более половины 5 ГБ пространства, используемого Snap.

```
du -h /var/lib/snapd/snaps
4.0K    /var/lib/snapd/snaps/partial
2.5G    /var/lib/snapd/snaps
```

#### 6. Очистка кэша миниатюр

Ubuntu автоматически создает миниатюру для просмотра в файловом менеджере. Он хранит эти эскизы в скрытом каталоге в вашей учетной записи пользователя по адресу `~/.cache/thumbnails` .

Со временем количество миниатюр резко увеличится. Более того, кэш эскизов со временем будет содержать множество лишних эскизов изображений, которых больше не существует.

Вы можете проверить размер кэша миниатюр с помощью команды ниже:

```bash
du -sh ~/.cache/thumbnails
```

В нашем примере, размер кэша миниатюр составляет более 300 МБ.

![Clean thumbnail cache to free up space in Ubuntu](https://itsfoss.com/wp-content/uploads/2017/06/clean-up-space-ubuntu-linux-3.png)

Поэтому рекомендуется очищать кэш эскизов каждые несколько месяцев или около того. Самый быстрый способ - использовать терминал:

```bash
rm -rf ~/.cache/thumbnails/*
```

#### 7. Найти и удалить дубликаты файлов

Иногда у вас могут быть дубликаты файлов в разных местах вашей системы. Избавление от дубликатов, безусловно, освободит место и очистит вашу систему Ubuntu.

Для этой задачи вы можете использовать инструмент с графическим интерфейсом, такой как `FSlint`, или инструмент командной строки, такой как `FDUPES`. Рекомендуется прочитать [эту](https://itsfoss.com/find-duplicate-files-linux/) статью, чтобы узнать, как использовать эти инструменты для удаления дубликатов файлов.

![Use FSlint tool find duplicate files in Linux](https://itsfoss.com/wp-content/uploads/2017/08/FSlint-dashboard.jpg)

![fdupes-tutorials](https://itsfoss.com/wp-content/uploads/2017/08/fdupes-tutorials-800x387.jpg)

#### Удалить старые ядра Linux, которые были установлены вручную*

Команда `sudo apt-get autoremove` удаляла старые ядра Linux, но не те которые были установлены вручную.

Выводим список всех установленных ядер Linux:

```bash
sudo dpkg --list 'linux-image*'
```

Удаляем старые образы ядра:

```bash
sudo apt-get remove linux-image-VERSION
```

Рекомендуется оставлять минимум 2-3 ядра, включая новейшее. Таким образом, у вас будет 1-2 опции запуска системы с соответствующим ядром, если по какой-то причине вы не смогли запуститься с новейшим.

#### Удалить осиротевшие пакеты (orphaned packages)*

Предположим, вы установили пакет ‘myprogram’. Но этот пакет имеет зависимость от библиотеки ‘mylib’. Эта библиотека обычно устанавливается автоматически с помощью ‘myprogram’. Когда вы удаляете ‘myprogram’, mylib все еще может оставаться в системе. Таким образом, mylib, в данном случае, становится **осиротевшим пакетом**.

Команда `sudo apt-get autoremove` удаляет такие потерянные пакеты. Но представьте себе случай, когда вы вручную установили ‘mylib‘ перед установкой ‘myprogram‘. Команда `‘apt autoremove’` в этом случае может не удалить потерянный пакет. И, следовательно, вам придется удалить его вручную.

Сначала вам нужно будет найти все потерянные пакеты, а затем удалить их.

Сделать нам это поможет консольная утилита `deborphan`.

```bash
sudo apt-get install deborphan
```

С помощью команды `deborphan` выводится список осиротевших пакетов.

Таким образом мы можем удалить все эти пакеты командой:

```bash
sudo apt-get remove `deborphan`
```

### Как освободить место на диске (GUI)

#### 1. Stacer

![Stacer](https://itsfoss.com/wp-content/uploads/2020/06/stacer.png)

**Ключевые особенности:**

- Панель инструментов для быстрого просмотра системных ресурсов
- Бесплатный и с открытым исходным кодом
- Очищает системы, чтобы освободить место в один клик
- [Управление запускаемыми приложениями в Ubuntu](https://itsfoss.com/manage-startup-applications-ubuntu/) для оптимизации производительности
- Поиск и управление службами, демонами
- Найдите и удалите программное обеспечение, чтобы освободить место

Написан на [Electron](https://electron.atom.io/). Вы можете прочитать эту статью, чтобы узнать [как оптимизировать Ubuntu  с помощью Stacer](https://itsfoss.com/optimize-ubuntu-stacer/).

**Установка:**

Вы можете установить его из PPA репозитория, как указано на официальном сайте - [Stacer](https://oguzhaninan.github.io/Stacer-Web/) или скачать AppImage/Deb/Rpm пакеты, доступные на [GitHub - раздел Releases](https://github.com/oguzhaninan/Stacer/releases).

Более подробно на [GitHub](https://github.com/oguzhaninan/Stacer).

#### 2. BleachBit

![Bleachbit Preview](https://itsfoss.com/wp-content/uploads/2019/10/bleachbit-preview-800x637.png)

**Особенности:**

- Простой графический интерфейс отметьте нужные поля, просмотрите его и удалите.
- Мультиплатформенность: Linux и Windows
- Бесплатный и с открытым исходным кодом
- Измельчайте (shred) файлы, чтобы скрыть их содержимое и предотвратить восстановление данных
- Перезаписать свободное место на диске, чтобы скрыть ранее удаленные файлы
- Также доступен интерфейс командной строки.

BleachBit имеет длинный список приложений, которые он поддерживает очистку и, таким образом, дает вам возможность очистки кеша, файлов cookie и файлов журнала.

**Установка:**

BleachBit имеет бинарные файлы, доступные для всех основных дистрибутивов Linux. Вы можете скачать BleachBit с официального сайта - [BleachBit](https://www.bleachbit.org/) или с репозиториев Ubuntu.

#### 3. Ubuntu Cleaner

![ubuntu cleaner](https://itsfoss.com/wp-content/uploads/2021/05/ubuntu-cleaner-800x481.png)

**Особенности:**

- Очищает кеш браузера
- Очищает кеш программного центра Ubuntu.
- Очищает кеш эскизов
- Удаляет кеш репозитория apt
- Удаляет старые файлы ядра
- Очищает конфиги пакетов

**Установка:**

Вы можете найти инструкции по добавлению PPA репозитория или скачивания DEB пакета на [GitHub странице](https://github.com/gerardpuig/ubuntu-cleaner).

## Сканирование диска (FSCK)

[Оригинальная статья](https://linuxize.com/post/fsck-command-in-linux/)

>Из-за различных неполадок или неожиданного отключения компьютера файловая система может быть повреждена. При обычном выключении все файловые системы монтируются только для чтения, а все не сохраненные данные записываются на диск.
>
>Но если питание выключается неожиданно, часть данных теряется, и могут быть потерянны важные данные, что приведет к повреждению самой файловой системы. Рассмотрим как восстановить файловую систему с помощью утилиты `fsck`.

`fsck` (file system check) — это утилита командной строки, которая позволяет выполнять проверки согласованности (consistency) и интерактивное восстановление одной или нескольких файловых систем Linux. Она использует программы, специфичные для типа проверяемой файловой системы.

Вы можете использовать команду `fsck` для восстановления поврежденных файловых систем в ситуациях, когда система не загружается или раздел не может быть смонтирован.

### Как пользоваться `fsck`

Общая форма:

```sh
fsck [Опции] [Файловая система]
```

В приведенном выше примере файловой системой может быть устройство, раздел, точка монтирования и т. п.

Если в качестве аргумента не указано `Файловая система`, `fsck` проверяет устройства, перечисленные в файле `/etc/fstab`.

Никогда не запускайте `fsck` на смонтированных разделах, так как это может повредить файловую систему. Прежде чем пытаться проверить или восстановить файловые системы, всегда сначала размонтируйте раздел командой [`umount`](https://linuxize.com/post/how-to-mount-and-unmount-file-systems-in-linux/).

Команда `fsck` представляет собой оболочку для различных средств проверки файловой системы Linux (`fsck.*`) и принимает различные опции в зависимости от типа файловой системы.

Смотрите страницы руководства для получения дополнительной информации о конкретной программе проверки. Например, чтобы просмотреть параметры, доступные для `fsck.ext4`, введите:

```bash
man fsck.ext4
```

### Восстановление поврежденной файловой системы

Самый простой вариант использования команды `fsck` — это восстановление поврежденной некорневой файловой системы ext3 или ext4.

1. Если вы не знаете имени устройства, используйте `df` или любую другую утилиту.

2. Размонтируйте устройство:

```bash
sudo umount /dev/sdc1
```


Run `fsck` to repair the file system:

```bash
sudo fsck -p /dev/sdc1
```

-   Опция `-p` применяется для автоматического устранения любых проблем, которые будут безопасно устранены без вмешательства пользователя.

-   После восстановления файловой системы смонтируйте раздел:

```bash
sudo mount /dev/sdc1
```


### Восстановление корневой файловой системы

`fsck` не может проверить корневую файловую систему на работающей машине, потому что ее нельзя размонтировать.

Если вы хотите проверить или восстановить корневую файловую систему, у вас есть несколько вариантов. Вы можете настроить `fsck` для запуска при загрузке, загрузить систему в режиме восстановления или использовать `live CD`.

#### Чтобы запустить `fsck` в режиме восстановления:

- Войдите в меню загрузки и выберите «Дополнительные параметры».
- Выберите режим восстановления, а затем «fsck».
- Когда будет предложено перемонтировать корневую файловую систему, выберите «Да».
- После этого возобновите нормальную загрузку.

#### Чтобы запустить `fsck` из `live CD`:

1. Загрузите действующий дистрибутив.

2. Используйте `fdisk` или `parted`, чтобы найти имя корневого раздела.

3. Откройте терминал и выполните:

```bash
sudo fsck -p /dev/sda1
```

4. После этого перезагрузите действующий дистрибутив и загрузите систему.

#### Проверка файловой системы при загрузке

В большинстве дистрибутивов Linux `fsck` запускается во время загрузки, если файловая система помечена как грязная (dirty), или после определенного количества загрузок или времени.

Чтобы увидеть текущий счетчик монтирования, номер частоты проверки, интервал проверки и время последней проверки для определенного раздела, используйте инструмент `tune2fs`:

```
sudo tune2fs -l /dev/sdc1 | grep -i 'last checked\|mount count'
```

```output
Mount count:              292
Maximum mount count:      -1
Last checked:             Tue Jul 24 11:10:07 2018
Check interval:           0 (<none>)
```

- «Maximum mount count» — количество монтирований, после которого будет проверена файловая система. Значение «0» или «-1» означает, что «fsck» никогда не запустится.
- «Check interval» — максимальное время между двумя проверками файловой системы.

Если, например, вы хотите запускать `fsck` после каждых 25 загрузок (монтирований), введите:

```bash
sudo tune2fs -c 25 /dev/sdc1
```

Вы также можете установить максимальное время между двумя проверками. Например, чтобы установить его на один месяц, вы должны запустить:

```bash
sudo tune2fs -i 1m /dev/sdc1
```

Чтобы заставить `fsck` запускаться во время загрузки в дистрибутивах `systemd`, передайте следующие параметры загрузки ядра:

```txt
fsck.mode=force
fsck.repair=yes
```

В старых дистрибутивах `fsck` будет запускаться при загрузке, если присутствует файл `/forcefsck`:

```bash
sudo touch /forcefsck
```

#### Опции `fstab`

`fstab` — это файл конфигурации, который сообщает системе, как и куда монтировать разделы. Файл `/etc/fstab` содержит список записей в следующем виде:

```sh
# [File System] [Mount Point] [File System Type] [Options] [Dump] [PASS]
/dev/sda1       /             ext4               defaults  0      1
/dev/sda2       /home         ext4               defaults  0      2
server:/dir     /media/nfs    nfs                defaults  0      0
```

Последний, шестой столбец (`[PASS]`) — это параметр, определяющий порядок, в котором выполняются проверки файловой системы во время перезагрузки. 

- `0` - Не проверять. 
- `1` - файловые системы, которые будут проверяться в первую очередь и по очереди. 
- `2` - Все остальные файловые системы, которые проверяются позже и, возможно, параллельно.

Корневая файловая система должна иметь значение `1`, а все остальные файловые системы, которые вы хотите проверить, должны иметь значение `2`.

## Дефрагментация

[Оригинальная статья](https://webistore.ru/administrirovaniye-unix/defragmentaciya-v-linux/)

При использовании носителей информации неизбежно возникает **фрагментация данных** — разбиение файлов на блоки, которые записываются в разных областях носителя. Поговорим о том, как исправить излишнюю фрагментацию данных в Linux.

Первым делом нужно сказать, что процедуру дефрагментации рекомендуется проводить **только для жёстких дисков**. Flash-накопители и SSD используют метод прямого доступа к памяти. Это значит, что время обращения к любой ячейке сравнительно мало, а её местонахождение становится не таким уж важным. Более того, поскольку количество циклов перезаписи у таких накопителей всё ещё меньше, чем у жёстких дисков, дефрагментация может наносить урон по продолжительности «жизни» накопителя. А вот позиционирующим головкам внутри жёстких дисков после дефрагментации приходится меньше перемещаться, что позитивно сказывается на времени обращения к файлам.

В Linux-сообществе нет единодушной позиции относительно того, полезна или бесполезна процедура дефрагментации в Linux. Дело в том, что файловые системы ext2, ext3 и ext4 стараются равномерно «раскидывать» новые файлы по диску. Если файл увеличивается в объёме, файловая система использует всё свободное пространство вокруг него. Если фрагментация всё же происходит, то файловая система старается в фоновом режиме переносить файлы в те места, где их фрагменты могут быть объединены. Успех? Не совсем.

Вышеописанные процедуры хорошо работают с дисками, у которых сравнительно много незанятого пространства. Но когда количество свободного пространства уменьшается, фрагментация становится возможной.

### e4defrag

Для проведения дефрагментации в Linux можно использовать утилиты **`e2defrag`** и **`e4defrag`** (для ext2 и ext4 соответственно). Утилита e2defrag может работать и с ext3, но только при условии временного преобразования файловой системы в ext2. Есть и другой способ — утилита **`Shake`**, которая может работать с разными файловыми системами.

Допустим, что нам нужно оценить, нуждается ли в дефрагментации раздел _/dev/sda2_. Это делается командой

```bash
sudo e4defrag -c /dev/sda2
```

Время выполнения команды зависит от того объёма информации, что предстоит проанализировать утилите. По окончании анализа вы увидите отчёт.

![Дефрагментация в Linux](https://webistore.ru/wp-content/uploads/2019/10/defragmentation_linux_01.png)

Если вы видите надпись «This device does not need defragmentation», то дефрагментация диску (разделу) не требуется.

Нужна ли дефрагментация можно также определить по значению **Fragmentation score**. Если оно лежит в диапазон от 0 до 30, то дефрагментация не требуется. Если значение представляет собой число от 31 до 55, то есть небольшие проблемы с фрагментацией файлов. При Fragmentation score от 56 и выше нужно провести процедуру дефрагментации.

Если вы хотите провести принудительную процедуру дефрагментации, воспользуйтесь командой

```bash
sudo e4defrag -v /dev/sda2
```

Естественно, если нужно произвести дефрагментацию другого раздела, то вместо _/dev/sda2_ следует указать нужное имя.

![Дефрагментация в Linux](https://webistore.ru/wp-content/uploads/2019/10/defragmentation_linux_02.png)

По итогам работы команды следует обратить внимание на показатель **Fragmented percentage**. Он показывает сколько было фрагментированных файлов и сколько стало. В нашем случае всё было хорошо и до дефрагментации, поэтому эта процедура толком ничего не изменила. Но бывают ситуации и похуже.

### Shake

Теперь посмотрим на утилиту [Shake](http://vleu.net/shake/). Это тоже весьма полезный дефрагментатор, который работает на основе эвристики и не требует внесения изменений в ядро или остановки работы системы. Суть работы утилиты Shake в том, что она просто перемещает файлы.

В целом, пользоваться утилитой очень просто — достаточно указать файл или каталог, который необходимо переместить.

```bash
sudo shake /home/test/
```

Командой выше мы переместили файлы в каталоге _/home/test_.

Если необходимо только посмотреть, насколько сильно фрагментирован файл или каталог, нужно использовать опции —pretend—verbose —verbose или -pvv

```bash
sudo shake -pvv /home/test/
```

Можно использовать и более сложные конструкции. Команда ниже проведёт дефрагментацию всех mp3-файлов в каталоге и рассортирует их.

```bash
find -iname '*.mp3' | sort | shake
```

Для более эффективной работы утилиты её автор рекомендует включать расширенные пользовательские атрибуты ([user_xattr](https://ru.manpages.org/xattr/7)).

Они по умолчанию включены в Ubuntu:

```bash
$ cat /proc/fs/ext4/sda1/options | grep xattr
user_xattr
```

Shake нечасто встретишь в репозиториях. У программы есть [страница на GitHub](https://github.com/unbrice/shake), а также [PPA-репозиторий](https://launchpad.net/~un-brice/+archive/ubuntu/ppa) .

Более подробно о синтаксисе Shake вам подскажет справка, которую можно вызвать командой

```bash
shake -h
```

![Дефрагментация в Linux](https://webistore.ru/wp-content/uploads/2019/10/defragmentation_linux_03.png)

Итак, фрагментация файлов в Linux имеет место быть. Она не является острой проблемой благодаря достоинствам файловых систем ext2, ext3 и ext4. Однако, если жёсткий диск или раздел забит файлами, рекомендуется периодически проводить проверку на наличие фрагментации.